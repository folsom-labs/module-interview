<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Modeling PV Modules by folsom-labs</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML.js'></script>
    
    <script>
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" }},
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
      });
    </script>
    
    <style>
      dl {width:400px;margin-bottom:4px;}
      dt {max-width:80px}
      dt:last-of-type, dd:last-of-type {border-bottom:none;}
      dd {margin-left:80px;margin-top:-22px;border-bottom:1px solid #EEE;}
      tr:nth-child(odd){background-color:whitesmoke};
    </style>

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Modeling PV Modules</h1>
        <p>Folsom Labs Exercise</p>

        <p class="view"><a href="https://github.com/folsom-labs/module-interview">View the Project on GitHub <small>folsom-labs/module-interview</small></a></p>


        <ul>
          <li><a href="https://github.com/folsom-labs/module-interview/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/folsom-labs/module-interview/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/folsom-labs/module-interview">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>
<a name="the-exercise" class="anchor" href="#the-exercise"><span class="octicon octicon-link"></span></a>The Exercise</h2>

<p>In this exercise, you'll implement some of the core math used to model the potential output of a solar panel (called a solar <em>module</em> in the industry).  This represents some of the core math that goes on deep in the process of simulating a solar photovoltaic array.</p>

<p>This isn't the kind of thing we work on day-to-day (though is based on a problem we've already tackled), our intent with this exercise is not to look for pure algorithmic skill, or to filter for people who love doing math, but simply as an interesting and relevant context to see how you structure and test your code/algorithms.</p>

<p><strong>Target Time:</strong>  1-2 hours</p>

<p><strong>Note:</strong> You shouldn't need any special math knowledge – there's a support section below that should give you all the equations you need. Feel free to ask as many clarification questions about how this all fits together.</p>

<h3>
<a name="the-tasks" class="anchor" href="#the-tasks"><span class="octicon octicon-link"></span></a>The tasks</h3>

<p>In the <a href="https://github.com/folsom-labs/module-interview">exercise repo</a>, we've included a CSV (<code>data.csv</code>) of module files, as well as a test file (<code>tests.py</code>).  The goal is to write an implementation of a solar module that makes the tests pass.</p>

<p>The boilerplate for the tests is in <code>tests.py</code>; to run the tests and see if your implementation is working use:</p>

<pre><code>$ python tests.py
</code></pre>

<p>Our tests are:</p>

<ol>
<li>
<p>Create a (python) module with functions that describe a (solar) module. Load the module coefficients for the Trina TSM PA05 from the CSV, set the temperature (T), to 25ºC and the irradiance (S) to 1000 W/m^2.</p>

<p>This test will pass when you calculate voltage and current matching the correct numerical values along the (solar) module's I/V curve.</p>
</li>
<li>
<p>Make sure your implementation produces accurate results at alternative irradiance and temperature levels.</p>

<p>Here we used an irradiance of 600 W/m^2, and a temperature of 45ºC on the same Trina module as in Task 1.</p>
</li>
<li>
<p>Usually, we don't just need to understand what the potential output of a solar module is (e.g. the I/V curve), we want to find out what voltage and current the module should be operating at in order to produce the most power.</p>

<p>Write a function/method that determines the voltage and current along a modules I/V curve that maximizes power.  We won't tell you what the answer is, so also write the test that proves you found it.</p>
</li>
<li>
<p>Write the tests to make sure your algorithm in Task 3 works for a range of module operating conditions and handles trick edge cases correctly.</p>

<p>For your reference, a module in the middle of the the Arizona desert at noon might have irradiance of ~1400 W/m^2.  A wintry London day might be 600 W/m^2.</p>
</li>
</ol><h2>
<a name="background" class="anchor" href="#background"><span class="octicon octicon-link"></span></a>Background</h2>

<p>Solar modules are generally built using silicon semiconductors (often made at old chip fabs), the same properties that enable chip designers build logic gates, enable sunlight (photons) to knock electrons around, creating electrical current. You don't need to know any of that, though. For this exercise, we just need to know that the equation that defines the output of a particular solar module is:</p>

<p>
\begin{equation}
    I=\left. {I_{sc} \cdot S} \middle/ {1000} \right. - I_0(T)\left(e^{\frac{q}{kT\gamma}\left(V+I \cdot R_s\right)}-1\right)-\frac{V+I \cdot R_s}{R_p}
\end{equation}
</p>

<p>Where, <em>I<sub>0</sub>(T)</em> is a function that adjusts the output of a solar module for the temperature it's operating at. All other things equal, at higher temperatures a module will output at about the same current, but a lower voltage (which is actually caused by the fact that electrons are more free to move around the semiconductor at higher temperatures).  This function is given by:</p>

<p>
\begin{equation}
    I_0(T)=I_0\left(1+\tau\right)^{T-298}
\end{equation}
</p>

<p>For a given solar module, almost all of the coefficients are pre-determined.  The <strong>Module Parameters</strong> are determined from <a href="http://www.suniva.com/documents/OPTXXX-60-4-1B0%202013%2002%2007.pdf">published specifications</a> to define a the baseline behavior for a specific module.  With the parameters in place, you can plug in the  that ultimately you can plug in the <strong>Environmental Inputs</strong>, for sunlight, <em>S</em> (technically this is called irradiance), and temperature, <em>T</em>.  Finally, you have an equation where the only remaining variables are voltage, <em>V</em>, and current, <em>I</em>,  this equation defines the output curve of a solar panel.</p>

<table>
<tr>
<th>
            Module Output
        </th>
        <td>
            <dl>
<dt>\(I\)</dt>
<dd>Current supplied by the module</dd>
                <dt>\(V\)</dt>
<dd>Voltage supplied by the module</dd>
            </dl>
</td>
    </tr>
<tr>
<th>
            Environmental Inputs
        </th>
        <td>
            <dl>
<dt>\(S\)</dt>
<dd>Effective Irradiance (W/M<sup>2)</sup>
</dd>
                <dt>\(T_{C}\)</dt>
<dd>Module (Cell) Temperature, (K)</dd>
            </dl>
</td>
    </tr>
<tr>
<th>
            Module Parameters
        </th>
        <td>
            <dl>
<dt>\(I_{sc}\)</dt>
<dd>The short-circuit current, the maximum current a module can output (Amps)</dd>
                <dt>\(I_{0}\)</dt>
<dd> inverse saturation current, how much is current reduced as voltage increases (Amps)</dd>
                <dt>\(R_{p}\)</dt>
<dd> Parallel resistance in connections within the module (Ohms, \(\Omega)\)</dd>
                <dt>\(R_{s}\)</dt>
<dd>Series Resistance in connections within the module (Ohms, \(\Omega)\)</dd>
                <dt>\(\gamma\)</dt>
<dd> Module ideality factor, typically 1-2, how round is the curve (dimensionless)</dd>
                <dt>\(\gamma\)</dt>
<dd> Module ideality factor, typically 1-2, how round is the curve (dimensionless)</dd>
                <dt>\(\tau\)</dt>
<dd> Temperature coefficient of \(I_{0}\) (dimensionless)</dd>
            </dl>
</td>
    </tr>
<tr>
<th>
            Physical Constants
        </th>
        <td>
            <dl>
<dt>\(q\)</dt>
<dd>Fundamental charge of the electron, 1.602 · 10<sup>-19</sup> (Coulomb)</dd>
                <dt>\(K\)</dt>
<dd>Boltzmann constant, 1.381 · 10<sup>-23</sup> (J/K)</dd>
            </dl>
</td>
    </tr>
</table><h4>
<a name="putting-it-all-together" class="anchor" href="#putting-it-all-together"><span class="octicon octicon-link"></span></a>Putting it all together</h4>

<p>When you plug in the formulation for a given solar module, you get a curve that looks like the image below. Basically, current output decreases as voltage output increases.</p>

<p>There are a few interesting points on the curve: <em>I<sub>sc</sub></em> is the short-circuit current, the maximum current a module can output (when there is no voltage); <em>V<sub>oc</sub></em> is the open-circuit voltage, the maximum voltage a module can output (when there is no current output); <em>V<sub>mp</sub></em> and <em>I<sub>mp</sub></em> define the maximum power of the module, the point on the output curve that maximizes the actual power output.  You may recall that power, <em>P</em>, is just voltage time current: $P = V \cdot I$.</p>

<p><img src="http://www.folsomlabs.com/modeling/modeling/moduleIV.jpg" alt="module IV Curve"></p>

<h4>
<a name="hints-on-solving-the-formula" class="anchor" href="#hints-on-solving-the-formula"><span class="octicon octicon-link"></span></a>Hints on Solving the Formula</h4>

<p>You may have noticed, that in the above formulation, output current, <em>I</em> is actually a function of both voltage and current.  That is, you can't just plug <em>V</em> in to find <em>I</em> or vice versa.  Fortunately, there's a standard approach for determining the output of the curves at a given point.</p>

<ol>
<li>
<p>Define a new quantity, the 'diode voltage', <em>V<sub>diode</sub></em>:</p>

<p>
\begin{equation}
   V_{diode} \equiv V + I \cdot R_s
\end{equation}
</p>
</li>
<li>
<p>Now, substitute this value into equation (1).  With this, you can choose a value of <em>V<sub>diode</sub></em> and determine both current and voltage.</p>

<p>
\begin{align*}
I(V_{diode})&amp;=\left. {I_{sc} \cdot S} \middle/ {1000} \right. - I_0(T)\left(e^{\frac{q}{kT\gamma} \cdot V_{diode}}-1\right)-\frac{V_{diode}}{R_p}
\\V(V_{diode}) &amp;= V_{diode} - I(V_{diode}) \cdot R_s
\end{align*}
</p>
</li>
</ol>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/folsom-labs">folsom-labs</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
